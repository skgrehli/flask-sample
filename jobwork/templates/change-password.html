<!DOCTYPE html>
<html class=" " ng-app="changepasswordListing">
    <head>
        <!--  
         * @Package: Ultra Admin - Responsive Theme
         * @Subpackage: Bootstrap
         * @Version: 4.1
         * This file is part of Ultra Admin Theme.
        -->
        <title>Change Password | Admin</title>
        {% include 'meta-tag.html' %}
        
    </head>
    <!-- END HEAD -->

    <!-- BEGIN BODY -->
    <body class=" " ng-controller="changepasswordCtrl"><!-- START TOPBAR -->
        {% include 'top-menu.html' %}
        <!-- END TOPBAR -->
        <!-- START CONTAINER -->
        <div class="page-container row-fluid">

            <!-- SIDEBAR - START -->
           {% include 'side-left.html' %}
             <!--  SIDEBAR - END -->
            <!-- START CONTENT -->
            <section id="main-content" class=" ">
                <section class="wrapper main-wrapper" style="">

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="page-title">


                          <div class="pull-left">
                               <h1 class="title">Change Password</h1>                        
                          </div>

                            <!--<div class="pull-right hidden-xs">
                                <ol class="breadcrumb">
                                    <li>
                                        <a href="index.html"><i class="fa fa-home"></i>Home</a>
                                    </li>
                                    <li>
                                        <a href="tables-basic.html">Tables</a>
                                    </li>
                                    <li class="active">
                                        <strong>Data Tables</strong>
                                    </li>
                                </ol>
                            </div>-->

                        </div>
                    </div>
                    <div class="clearfix"></div>




                    <div class="content-body">  
                        <div class="row">
                        
                            <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12" style="margin-bottom: 25px;">
                                <section class="box ">
                                    <header class="panel_header">
                                        <h2 class="title pull-left">Change Password</h2>
                                        <div class="actions panel_actions pull-right">
                                            <!--<i class="box_toggle fa fa-chevron-down"></i>-->
                                            <!--<i class="box_setting fa fa-cog" data-toggle="modal" href="#section-settings"></i>-->
                                            <!--<i class="box_close fa fa-times"></i>-->
                                        </div>
                                    </header>
                                    <div class="content-body">
                                        <div class="row">
                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                <form class="form-horizontal" role="form" method="POST" name="changepasswordAdmin" id="changepasswordAdmin" ng-submit="changepassword(changepasswordAdmin.$valid)" novalidate>
                                                    <div class="form-group" ng-class="{'has-error':oldpassword.$invalid && !oldpassword.$pristine}">
                                                        <label for="input-text" class="col-sm-2 control-label">Current Password</label>
                                                        <div class="col-sm-5">
                                                          <input type="password" class="form-control" name="oldpassword" id="oldpassword" ng-model="oldpassword" focus="focus.oldpassword" autocomplete="off" placeholder="Enter your old password" ng-required />
                                                          <p ng-show="submitted && changepasswordAdmin.oldpassword.$error.required" class="error" style="margin-top:0px;">Current password is required.</p>
                                                          
                                                        </div>
                                                    </div>

                                                   <div class="form-group" ng-class="{'has-error':newpassword.$invalid && !newpassword.$pristine}">
                                                    <label for="input-text" class="col-sm-2 control-label">New Password</label>
                                                    <div class="col-sm-5">
                                                      <!-- <input type="password" class="form-control" id="newpassword" ng-model="newpassword" autocomplete="off" placeholder="Enter your new password" required /> -->
                                                      <!-- <p ng-show="submitted && changepasswordAdmin.newpassword.$error.required" class="error" style="margin-top:0px;">New Password is required.</p>  -->
                                                      <input type="password" class="form-control" id="newpassword" name="newpassword" ng-model="newpassword" focus="focus.newpassword" ng-minlength="8" ng-maxlength="20" ng-pattern="/(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z])/" placeholder="Enter your New Password" ng-required />

                                                        <p ng-show="submitted && changepasswordAdmin.newpassword.$error.required" class="error" style="margin-top:0px;">New Password Required.</p>
                                                        <p ng-show="submitted && changepasswordAdmin.newpassword.$error.minlength" class="error" style="margin-top:0px;">
                                                          Passwords must be between 8 and 20 characters.</p>
                                                        <p ng-show="submitted && changepasswordAdmin.newpassword.$error.pattern" class="error" style="margin-top:0px;">
                                                          Must contain one lower &amp; uppercase letter, and one non-alpha character (a number or a symbol.)</p>
                                                    </div>
                                                  </div>

                                                   <div class="form-group" ng-class="{'has-error':confirmpassword.$invalid && !confirmpassword.$pristine}">
                                                    <label for="input-text" class="col-sm-2 control-label">Re-write New Password</label>
                                                    <div class="col-sm-5">
                                                      <!-- <input type="password" class="form-control" id="confirmpassword" ng-model="confirmpassword" autocomplete="off" placeholder="Please confirm your new password" required compare-to="newpassword" />
                                                      <p ng-show="submitted && changepasswordAdmin.confirmpassword.$error.required" class="error" style="margin-top:0px;">Re-write Password is required.</p>
                                                      <p ng-show="submitted && changepasswordAdmin.confirmpassword.$error.compareTo" class="error" style="margin-top:0px;">Must match the previous entry.</p> -->
                                                      <input type="password" class="form-control" id="confirmpassword" name="confirmpassword" focus="focus.confirmpassword" ng-model="confirmpassword" placeholder="confirm password" ng-required valid-password-c="newpassword" required />
                                                        <p ng-show="submitted && changepasswordAdmin.confirmpassword.$error.required" class="error">Confirm Password Required.</p>
                                                        <p ng-show="submitted && changepasswordAdmin.confirmpassword.$error.noMatch" class="error">Passwords do not match.</p>

                                                    </div>
                                                  </div>

                                                  <div class="form-group">                          
                                                    <button type="submit" class="btn btn-primary" ng-disabled="isSaveDisabled" ng-model="saveButton" ng-click="submitted=true">Save</button>
                                                    </div>
                                                </form>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>                            
                            
                        </div><!--row close-->
                    </div><!--content body close-->
                        
                        
                        
                        
                     
                    </section>
                </section>
                <!-- END CONTENT -->
                
                <div class="chatapi-windows ">
    
    
                </div>    
                </div>
        <!-- END CONTAINER -->
        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->

        {% include 'footer.html' %}
        <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-resource.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-sanitize.js"></script>
        <script>
            var app = angular.module('changepasswordListing', []);
            app.config(function($interpolateProvider) {
                $interpolateProvider.startSymbol('{&');
                $interpolateProvider.endSymbol('&}');
            });
            app.directive('validPasswordC', function() {
              return {
                require: 'ngModel',
                scope: {

                  reference: '=validPasswordC'

                },
                link: function(scope, elm, attrs, ctrl) {
                  ctrl.$parsers.unshift(function(viewValue, $scope) {

                    var noMatch = viewValue != scope.reference
                    ctrl.$setValidity('noMatch', !noMatch)
                  });

                  scope.$watch("reference", function(value) {;
                    ctrl.$setValidity('noMatch', value === ctrl.$viewValue);

                  });
                }
                /*link: function (scope, elem, attrs, ctrl) {
			        var firstPassword = '#' + attrs.validPasswordC;
			        elem.add(firstPassword).on('keyup', function () {
			          scope.$apply(function () {
			            var v = elem.val()===$(firstPassword).val();
			            ctrl.$setValidity('pwmatch', v);
			          });
			        });
			      }*/

              }
            });
            app.controller('changepasswordCtrl', function($scope,$http,$window) 
            {
                $scope.count = 0;
                $scope.userid = {{session['adminid']}};
                $scope.token = "{{session['token']}}";
                // // console.log($scope.count);
                $scope.isSaveDisabled = false;
                $scope.isUpdateDisabled = true;
                $scope.flag = false;

                $scope.changepassword = function(isValid) 
                    {
                        if (isValid) 
                        {
                            // // console.log($scope.oldpassword + $scope.newpassword);
                    		$http({
                            url: "/check_changepassword",
                            method: "POST",
                            data: {"userid":$scope.userid,
                            		"token":$scope.token,
                            		"currentpassword":$scope.oldpassword,
                            		"newpassword":$scope.newpassword}
                            }).success(function(data, status, headers, config) 
                            {
                                // $scope.languagesArray = $scope.languagesArray.splice(0, 0, data['last_added_skill']);
                                // // console.log(data);
                                $scope.oldpassword = "";
                                $scope.newpassword = "";
                                $scope.confirmpassword = "";
                                if (data['status'] == 200)
                                {
                                    swal("Changed!", "Password successfully changed.", "success");
                                }
                                else if (data['status'] == 400)
                                {
                                    swal("Invalid Old Password.");
                                }
                                else if (data['status'] == 201)
                                {
                                    swal("Invalid User.");
                                }

                            }).error(function(data, status, headers, config) {
                                $scope.status = status;
                                // // console.log(data);
                                // // console.log(status);
                            });
                    	}
                    };
                });
        </script>
    </body>
</html>